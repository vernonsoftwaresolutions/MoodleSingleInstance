--- 
machine: 
  python: 
    version: "2.7.11"
  ruby: 
    version: "2.4.0"
  services: 
    - docker

dependencies: 
  override: 
    - "aws configure set default.region us-east-1"
    - "aws configure set default.output json"

test: 
  post: 
    - "aws cloudformation validate-template --template-body file://cloudformation/ecs.yml"

deployment: 
  development: 
    branch: moodle29
    commands: 
      - "aws cloudformation package --template-file cloudformation/ecs.yml --output-template-file ecs-output.yml --s3-bucket circleci.deployables"
      - "aws cloudformation deploy --template-file ecs-output.yml --capabilities CAPABILITY_IAM --stack-name moodle-ecs-single --parameter-overrides KeyName=dummy_key1 VpcId=vpc-c7aa77be SubnetId=subnet-b61d81fe,subnet-0202dc58 InstanceType=t2.medium "